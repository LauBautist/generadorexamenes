<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados de Exámenes</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #95b8d1;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 50px auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #d6156c;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }

        th {
            background-color: #eac4d5;
            color: #8b4363;
        }

        .input-field {
            margin-bottom: 20px;
        }

        #searchInput {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .button-back {
            display: inline-block;
            background-color: #a3d2ca;
            color: #004d40;
            text-align: center;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 20px;
            transition: background-color 0.3s ease;
        }

        .button-back:hover {
            background-color: #8ec3b0;
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBLwvUz_7V6rAcDrAEkpb2PqMuxbSFBo5I",
            authDomain: "cuentas-ddcbc.firebaseapp.com",
            projectId: "cuentas-ddcbc",
            storageBucket: "cuentas-ddcbc.appspot.com",
            messagingSenderId: "416491681259",
            appId: "1:416491681259:web:41697ff964d1acede8d5ae"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let resultadosExamenes = []; // Variable global para almacenar los resultados

        async function obtenerResultados() {
            // Reemplaza '1TJWDvkatPUJgy4tujrXLGYQHz23' con el uid deseado
            const uid = "1TJWDvkatPUJgy4tujrXLGYQHz23";

            try {
                const examenResueltoCollection = collection(db, "ExamenResuelto");
                const resultadosQuery = query(
                    examenResueltoCollection,
                    where("uid", "==", uid),
                    where("examenCompletado", "==", true)
                );

                const querySnapshot = await getDocs(resultadosQuery);
                resultadosExamenes = []; // Limpiar la lista de resultados anteriores

                querySnapshot.forEach((doc) => {
                    resultadosExamenes.push(doc.data());
                });

                mostrarResultados(resultadosExamenes);
            } catch (error) {
                console.error("Error al buscar resultados:", error);
                alert("Ocurrió un error al obtener los resultados. Intenta de nuevo.");
            }
        }

        // Mostrar los resultados en la tabla
        function mostrarResultados(resultados) {
            const resultadosContainer = document.getElementById('resultadosContainer');
            resultadosContainer.innerHTML = ''; // Limpiar la tabla

            if (resultados.length === 0) {
                resultadosContainer.innerHTML = `<tr><td colspan="5" style="text-align: center;">No se encontraron resultados.</td></tr>`;
                return;
            }

            resultados.forEach((data) => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${data.fullName}</td>
                    <td>${data.idExamen}</td>
                    <td>${data.calificacion}</td>
                    <td>${data.aciertos}</td>
                    <td>${new Date(data.fechaHoraTermina).toLocaleString()}</td>
                `;
                resultadosContainer.appendChild(fila);
            });
        }

        // Filtrar los resultados por idExamen
        function filtrarResultados() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                const resultadosFiltrados = resultadosExamenes.filter(examen =>
                    examen.idExamen.toLowerCase().includes(searchTerm)
                );
                mostrarResultados(resultadosFiltrados);
            } else {
                mostrarResultados(resultadosExamenes); // Mostrar todos si no hay búsqueda
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            obtenerResultados();
            document.getElementById('searchInput').addEventListener('input', filtrarResultados);
        });
    </script>
</head>

<body>
    <div class="container">
        <h1>Resultados de Exámenes</h1>

        <label for="searchInput">Buscar Examen por nombre para saber la calificación: </label>
        <div class="input-field">
            <input type="text" id="searchInput" placeholder="Buscar por nombre de examen..." class="validate">
        </div>
        <table class="highlight responsive-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>ID Examen</th>
                    <th>Calificación</th>
                    <th>Aciertos</th>
                    <th>Fecha de Finalización</th>
                </tr>
            </thead>
            <tbody id="resultadosContainer">
                <!-- Aquí se agregarán dinámicamente los resultados -->
            </tbody>
        </table>
        <div class="button-container">
            <a href="Clases.html" class="button-back">Regresar</a> <!-- Botón de regresar centrado -->
        </div>
    </div>
</body>

</html>

